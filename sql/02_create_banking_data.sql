-- =====================================================================
-- SEA RETAIL BANKING DEMO - SAMPLE DATA CREATION
-- Purpose: Create realistic banking data for Malaysia/Singapore region
-- Run as: ACCOUNTADMIN
-- =====================================================================

USE ROLE ACCOUNTADMIN;
USE DATABASE RETAIL_BANKING_DEMO;
USE WAREHOUSE BANKING_WH;

-- =====================================================================
-- BRONZE LAYER - RAW SOURCE DATA (SEA REGION)
-- =====================================================================

USE SCHEMA BRONZE;

-- ---------------------------------------------------------------------
-- 1. CUSTOMERS TABLE - Malaysia/Singapore Names and Locations
-- ---------------------------------------------------------------------

CREATE OR REPLACE TABLE SRC_CUSTOMERS (
    CUSTOMER_ID STRING PRIMARY KEY,
    FIRST_NAME STRING,
    LAST_NAME STRING,
    EMAIL STRING,
    PHONE STRING,
    DATE_OF_BIRTH DATE,
    NRIC_PASSPORT STRING,  -- NRIC for Malaysia/Singapore
    STREET_ADDRESS STRING,
    CITY STRING,
    STATE STRING,  -- Malaysian states or Singapore
    POSTAL_CODE STRING,
    COUNTRY STRING,  -- Malaysia or Singapore
    CUSTOMER_SINCE DATE,
    CUSTOMER_SEGMENT STRING,  -- RETAIL, PREMIUM, BUSINESS
    ANNUAL_INCOME_MYR NUMBER(12,2),  -- Income in MYR
    CREDIT_SCORE NUMBER(3,0),
    EMPLOYMENT_STATUS STRING,
    CREATED_TS TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

-- Insert Malaysian and Singaporean customers (with data quality issues)
INSERT INTO SRC_CUSTOMERS VALUES
-- MALAYSIA - Kuala Lumpur
('CUST001','Ahmad','Ibrahim','ahmad.ibrahim@email.com','+60-12-345-6789','1985-03-15','850315-10-5234','Jalan Sultan Ismail','Kuala Lumpur','Kuala Lumpur','50250','Malaysia','2020-01-15','RETAIL',180000.00,720,'EMPLOYED',CURRENT_TIMESTAMP()),
('CUST002','Siti','Nurhaliza','siti.n@email.com','+60-12-456-7890','1990-07-22','900722-08-3456','Jalan Ampang','Kuala Lumpur','Kuala Lumpur','50450','Malaysia','2019-05-20','PREMIUM',350000.00,780,'EMPLOYED',CURRENT_TIMESTAMP()),
('CUST003','Raj','Kumar','raj.kumar@invalid','+60-12-567-8901','1978-11-30','781130-14-2345','Jalan Bukit Bintang','Kuala Lumpur','Kuala Lumpur','55100','Malaysia','2021-03-10','RETAIL',150000.00,690,'EMPLOYED',CURRENT_TIMESTAMP()),  -- Invalid email
('CUST004','Mei Ling','Tan',NULL,'+60-12-678-9012','1995-02-14','950214-01-4567','Jalan Tun Razak','Kuala Lumpur','Kuala Lumpur','50400','Malaysia','2022-06-01','RETAIL',120000.00,650,'EMPLOYED',CURRENT_TIMESTAMP()),  -- Missing email

-- MALAYSIA - Penang
('CUST005','Michael','Tan','michael.tan@email.com','+60-4-234-5678','1982-09-08','820908-07-6789','Gurney Drive','George Town','Penang','10250','Malaysia','2018-11-25','PREMIUM',420000.00,810,'SELF_EMPLOYED',CURRENT_TIMESTAMP()),
('CUST006','Jennifer','Wong','jennifer.wong@email.com','+60-4-345-6789','1988-04-17','880417-07-8901','Jalan Macalister','George Town','Penang','10400','Malaysia','2020-08-12','RETAIL',160000.00,700,'EMPLOYED',CURRENT_TIMESTAMP()),

-- MALAYSIA - Johor Bahru
('CUST007','X','Lee','x.lee@email.com','+60-7-456-7890','1992-12-25','921225-01-2345','Jalan Wong Ah Fook','Johor Bahru','Johor','80000','Malaysia','2021-01-30','RETAIL',140000.00,680,'EMPLOYED',CURRENT_TIMESTAMP()),  -- Very short first name
('CUST008','Linda','Lim','linda.lim@email.com','+60-7-567-8901','1975-06-19','750619-01-3456','Jalan Trus','Johor Bahru','Johor','80300','Malaysia','2019-09-18','PREMIUM',380000.00,750,'EMPLOYED',CURRENT_TIMESTAMP()),

-- SINGAPORE
('CUST009','David','Chong','david.chong@email.com',NULL,'1998-01-05','S9801234A','Orchard Road','Singapore','Singapore','238858','Singapore','2023-02-14','RETAIL',120000.00,640,'EMPLOYED',CURRENT_TIMESTAMP()),  -- Missing phone
('CUST010','Barbara','Tan','barbara.tan@email.com','+65-9123-4567','1980-08-28','S8008234B','Marina Bay','Singapore','Singapore','018956','Singapore','2020-04-22','RETAIL',200000.00,730,'EMPLOYED',CURRENT_TIMESTAMP()),
('CUST011','James','Ng','james.ng@email.com','+65-9234-5678','2010-03-01','S1003234C','Raffles Place','Singapore','Singapore','048619','Singapore','2023-05-10','RETAIL',80000.00,300,'STUDENT',CURRENT_TIMESTAMP()),  -- Too young + low credit
('CUST012','Sarah','Lim','sarah.lim@email.com','+65-9345-6789','1987-10-12','S8710234D','Tanjong Pagar','Singapore','Singapore','088539','Singapore','2021-07-08','PREMIUM',280000.00,760,'EMPLOYED',CURRENT_TIMESTAMP()),

-- DUPLICATE for testing
('CUST002','Siti','Nurhaliza','siti.duplicate@email.com','+60-19-999-9999','1990-07-22','900722-08-3456','Duplicate Address','Kuala Lumpur','Kuala Lumpur','50450','Malaysia','2019-05-20','PREMIUM',350000.00,780,'EMPLOYED',CURRENT_TIMESTAMP()),  -- DUPLICATE

-- MALAYSIA - Selangor
('CUST013','William','Chan','william.chan@email.com','+60-3-8765-4321','1993-05-30','930530-10-5678','Jalan SS2','Petaling Jaya','Selangor','47300','Malaysia','2022-09-15','RETAIL',170000.00,710,'EMPLOYED',CURRENT_TIMESTAMP()),
('CUST014','Elizabeth','Hassan','elizabeth.hassan@email.com','+60-3-7654-3210','1991-11-20','911120-14-6789','Shah Alam','Shah Alam','Selangor','40000','Malaysia','2020-12-03','RETAIL',155000.00,695,'EMPLOYED',CURRENT_TIMESTAMP());

-- ---------------------------------------------------------------------
-- 2. ACCOUNTS TABLE - SEA Currency (MYR/SGD)
-- ---------------------------------------------------------------------

CREATE OR REPLACE TABLE SRC_ACCOUNTS (
    ACCOUNT_ID STRING PRIMARY KEY,
    CUSTOMER_ID STRING,
    ACCOUNT_TYPE STRING,  -- CHECKING, SAVINGS, CREDIT_CARD, LOAN
    ACCOUNT_STATUS STRING,  -- ACTIVE, CLOSED, SUSPENDED
    OPEN_DATE DATE,
    CURRENT_BALANCE_MYR NUMBER(15,2),  -- Balance in MYR
    AVAILABLE_BALANCE_MYR NUMBER(15,2),
    INTEREST_RATE NUMBER(5,2),
    CREDIT_LIMIT_MYR NUMBER(15,2),
    MONTHLY_FEE_MYR NUMBER(6,2),
    BRANCH_ID STRING,  -- SEA branch codes
    CREATED_TS TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

-- Insert sample accounts (SEA branches)
INSERT INTO SRC_ACCOUNTS VALUES
('ACC001','CUST001','CHECKING','ACTIVE','2020-01-15',12800.50,12800.50,0.01,NULL,0.00,'BR_KL01',CURRENT_TIMESTAMP()),  -- Kuala Lumpur
('ACC002','CUST001','SAVINGS','ACTIVE','2020-01-15',35000.00,35000.00,1.50,NULL,0.00,'BR_KL01',CURRENT_TIMESTAMP()),
('ACC003','CUST002','CHECKING','ACTIVE','2019-05-20',25600.25,25600.25,0.01,NULL,0.00,'BR_KL02',CURRENT_TIMESTAMP()),
('ACC004','CUST002','CREDIT_CARD','ACTIVE','2019-06-01',5800.00,24200.00,18.99,30000.00,0.00,'BR_KL02',CURRENT_TIMESTAMP()),
('ACC005','CUST003','CHECKING','ACTIVE','2021-03-10',3200.75,3200.75,0.01,NULL,10.00,'BR_KL03',CURRENT_TIMESTAMP()),
('ACC006','CUST004','SAVINGS','ACTIVE','2022-06-01',8500.00,8500.00,1.25,NULL,0.00,'BR_KL04',CURRENT_TIMESTAMP()),
('ACC007','CUST005','CHECKING','ACTIVE','2018-11-25',42000.00,42000.00,0.01,NULL,0.00,'BR_PG01',CURRENT_TIMESTAMP()),  -- Penang
('ACC008','CUST005','CREDIT_CARD','ACTIVE','2018-12-01',15200.00,59800.00,15.99,75000.00,0.00,'BR_PG01',CURRENT_TIMESTAMP()),
('ACC009','CUST006','CHECKING','ACTIVE','2020-08-12',11500.80,11500.80,0.01,NULL,0.00,'BR_PG02',CURRENT_TIMESTAMP()),
('ACC010','CUST007','SAVINGS','ACTIVE','2021-01-30',22800.00,22800.00,1.75,NULL,0.00,'BR_JB01',CURRENT_TIMESTAMP()),  -- Johor Bahru
('ACC011','CUST008','CHECKING','ACTIVE','2019-09-18',58500.50,58500.50,0.01,NULL,0.00,'BR_JB02',CURRENT_TIMESTAMP()),
('ACC012','CUST008','CREDIT_CARD','ACTIVE','2019-10-01',22800.00,52200.00,16.99,75000.00,0.00,'BR_JB02',CURRENT_TIMESTAMP()),
('ACC013','CUST009','CHECKING','ACTIVE','2023-02-14',2850.25,2850.25,0.01,NULL,10.00,'BR_SG01',CURRENT_TIMESTAMP()),  -- Singapore
('ACC014','CUST010','SAVINGS','ACTIVE','2020-04-22',48500.00,48500.00,1.50,NULL,0.00,'BR_SG02',CURRENT_TIMESTAMP()),
('ACC015','CUST011','CHECKING','ACTIVE','2023-05-10',-450.00,-450.00,0.01,NULL,0.00,'BR_SG03',CURRENT_TIMESTAMP()),  -- Negative balance (overdraft)
('ACC016','CUST012','CREDIT_CARD','ACTIVE','2021-07-08',3200.00,26800.00,17.99,30000.00,0.00,'BR_SG04',CURRENT_TIMESTAMP()),
('ACC017','CUST999','CHECKING','ACTIVE','2023-01-01',12000.00,12000.00,0.01,NULL,0.00,'BR_KL01',CURRENT_TIMESTAMP()),  -- Unknown customer
('ACC018','CUST013','SAVINGS','CLOSED','2022-09-15',0.00,0.00,1.50,NULL,0.00,'BR_SL01',CURRENT_TIMESTAMP()),  -- Selangor
('ACC019','CUST014','CHECKING','ACTIVE','2020-12-03',17800.90,17800.90,0.01,NULL,0.00,'BR_SL02',CURRENT_TIMESTAMP()),
('ACC020','CUST001','LOAN','ACTIVE','2021-06-01',-68000.00,-68000.00,5.25,NULL,0.00,'BR_KL01',CURRENT_TIMESTAMP());  -- Loan account

-- ---------------------------------------------------------------------
-- 3. TRANSACTIONS TABLE - SEA Merchants and Locations
-- ---------------------------------------------------------------------

CREATE OR REPLACE TABLE SRC_TRANSACTIONS (
    TRANSACTION_ID STRING PRIMARY KEY,
    ACCOUNT_ID STRING,
    CUSTOMER_ID STRING,
    TRANSACTION_DATE STRING,  -- Intentionally STRING
    TRANSACTION_TYPE STRING,
    AMOUNT_MYR NUMBER(15,2),  -- Amount in MYR
    CHANNEL STRING,
    MERCHANT_NAME STRING,
    CATEGORY STRING,
    DESCRIPTION STRING,
    STATUS STRING,
    CREATED_TS TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

-- Insert SEA region transactions
INSERT INTO SRC_TRANSACTIONS VALUES
('TXN001','ACC001','CUST001','2024-11-01 09:15:00','DEPOSIT',4200.00,'BRANCH',NULL,'INCOME','Salary deposit','COMPLETED',CURRENT_TIMESTAMP()),
('TXN002','ACC001','CUST001','2024-11-02 14:22:00','PURCHASE',125.50,'POS','Tesco Malaysia','GROCERIES','Weekly groceries','COMPLETED',CURRENT_TIMESTAMP()),
('TXN003','ACC001','CUST001','2024-11-03 18:30:00','PURCHASE',180.00,'POS','Nasi Kandar Restaurant','DINING','Dinner at Penang Road','COMPLETED',CURRENT_TIMESTAMP()),
('TXN004','ACC002','CUST001','2024-11-05 10:00:00','TRANSFER',1200.00,'MAYBANK2U',NULL,'TRANSFER','Transfer to checking','COMPLETED',CURRENT_TIMESTAMP()),
('TXN005','ACC003','CUST002','2024-11-01 08:45:00','DEPOSIT',8500.00,'MOBILE',NULL,'INCOME','Monthly salary','COMPLETED',CURRENT_TIMESTAMP()),
('TXN006','ACC004','CUST002','2024-11-03 15:20:00','PAYMENT',600.00,'WEB','Credit Card Payment','PAYMENT','CC payment','COMPLETED',CURRENT_TIMESTAMP()),
('TXN007','ACC005','CUST003','2024-11-02 12:10:00','WITHDRAWAL',-150.00,'ATM',NULL,'CASH','ATM withdrawal at KLCC','COMPLETED',CURRENT_TIMESTAMP()),  -- Negative (error)
('TXN008','ACC009','CUST006','2024-11-04 16:45:00','PURCHASE',320.00,'POS','Courts Malaysia','SHOPPING','Home appliance','COMPLETED',CURRENT_TIMESTAMP()),
('TXN009','ACC011','CUST008','2024-11-01 11:30:00','DEPOSIT',12000.00,'BRANCH',NULL,'INCOME','Business income','COMPLETED',CURRENT_TIMESTAMP()),
('TXN010','ACC013','CUST009','2024-11-03 09:00:00','PURCHASE',8.50,'POS','Ya Kun Kaya Toast','DINING','Breakfast Singapore','COMPLETED',CURRENT_TIMESTAMP()),
('TXN011','ACC015','CUST011','2024-11-05 14:15:00','PURCHASE',480.00,'POS','Popular Bookstore','SHOPPING','Textbooks','COMPLETED',CURRENT_TIMESTAMP()),
('TXN012','ACC001','CUST001','invalid-date','PURCHASE',75.00,'POS','Petronas Station','TRANSPORTATION','Petrol','COMPLETED',CURRENT_TIMESTAMP()),  -- Invalid date
('TXN013','ACC007','CUST005','2024-11-02 10:20:00','WITHDRAWAL',2500.00,'ATM',NULL,'CASH','ATM Penang','COMPLETED',CURRENT_TIMESTAMP()),
('TXN014','ACC001','CUST001','2024-11-06 08:00:00','PURCHASE',NULL,'POS','Guardian Pharmacy','HEALTHCARE','Medicine','COMPLETED',CURRENT_TIMESTAMP()),  -- NULL amount
('TXN015','ACC019','CUST014','2024-11-01 13:40:00','DEPOSIT',5200.00,'MOBILE',NULL,'INCOME','Salary','COMPLETED',CURRENT_TIMESTAMP()),
('TXN016','ACC003','CUST002','2024-11-04 19:25:00','PURCHASE',385.00,'WEB','Lazada Malaysia','SHOPPING','Online shopping','COMPLETED',CURRENT_TIMESTAMP()),
('TXN017','ACC999','CUST001','2024-11-05 11:00:00','PURCHASE',120.00,'POS','Store','SHOPPING','Shopping','COMPLETED',CURRENT_TIMESTAMP()),  -- Unknown account
('TXN018','ACC001','CUST001','2026-01-01 00:00:00','DEPOSIT',2500.00,'BRANCH',NULL,'INCOME','Future deposit','PENDING',CURRENT_TIMESTAMP()),  -- Future date
('TXN019','ACC006','CUST004','2024-11-02 15:50:00','TRANSFER',250.00,'WEB',NULL,'TRANSFER','DuitNow transfer','COMPLETED',CURRENT_TIMESTAMP()),
('TXN020','ACC010','CUST007','2024-11-03 10:30:00','DEPOSIT',1200.00,'BRANCH',NULL,'INCOME','Deposit','COMPLETED',CURRENT_TIMESTAMP()),
('TXN021','ACC012','CUST008','2024-11-01 17:15:00','PAYMENT',1500.00,'WEB','Credit Card Payment','PAYMENT','CC payment','COMPLETED',CURRENT_TIMESTAMP()),
('TXN022','ACC001','CUST001','2024-11-07 09:45:00','PURCHASE',2850000.00,'POS','Poh Kong Jewellers','SHOPPING','Wedding ring','COMPLETED',CURRENT_TIMESTAMP()),  -- Suspicious large
('TXN023','ACC014','CUST010','2024-11-05 14:00:00','WITHDRAWAL',800.00,'ATM',NULL,'CASH','ATM Singapore','COMPLETED',CURRENT_TIMESTAMP()),
('TXN024','ACC016','CUST012','2024-11-02 12:20:00','PURCHASE',195.00,'POS','FairPrice Singapore','SHOPPING','Groceries','COMPLETED',CURRENT_TIMESTAMP()),
('TXN025','ACC005','CUST003','2024-11-06 16:30:00','PURCHASE',95.00,'POS','Shell Station','TRANSPORTATION','Petrol','COMPLETED',CURRENT_TIMESTAMP()),
('TXN026','ACC009','CUST006','2024-11-04 11:10:00','DEPOSIT',2100.00,'MOBILE',NULL,'INCOME','Freelance payment','COMPLETED',CURRENT_TIMESTAMP()),
('TXN027','ACC013','CUST009','2024-11-07 08:25:00','WITHDRAWAL',0.00,'ATM',NULL,'CASH','ATM withdrawal','FAILED',CURRENT_TIMESTAMP()),  -- Zero amount
('TXN028','ACC007','CUST005','2024-11-05 15:40:00','PURCHASE',850.00,'WEB','AirAsia','TRAVEL','Flight to Bangkok','COMPLETED',CURRENT_TIMESTAMP()),
('TXN029','ACC019','CUST014','2024-11-06 10:50:00','PURCHASE',165.00,'POS','AEON Mall','GROCERIES','Weekly shopping','COMPLETED',CURRENT_TIMESTAMP()),
('TXN030','ACC011','CUST008','31-02-2024','PURCHASE',145.00,'POS','Mamak Restaurant','DINING','Lunch','COMPLETED',CURRENT_TIMESTAMP());  -- Impossible date

-- ---------------------------------------------------------------------
-- 4. LOANS TABLE - SEA Region
-- ---------------------------------------------------------------------

CREATE OR REPLACE TABLE SRC_LOANS (
    LOAN_ID STRING PRIMARY KEY,
    CUSTOMER_ID STRING,
    LOAN_TYPE STRING,  -- PERSONAL, MORTGAGE, AUTO, EDUCATION, BUSINESS
    LOAN_AMOUNT_MYR NUMBER(15,2),  -- Loan in MYR
    INTEREST_RATE NUMBER(5,2),
    TERM_MONTHS NUMBER(3,0),
    MONTHLY_PAYMENT_MYR NUMBER(10,2),
    OUTSTANDING_BALANCE_MYR NUMBER(15,2),
    LOAN_STATUS STRING,
    ORIGINATION_DATE DATE,
    MATURITY_DATE DATE,
    LAST_PAYMENT_DATE DATE,
    CREDIT_SCORE_AT_ORIGINATION NUMBER(3,0),
    COLLATERAL_TYPE STRING,
    BRANCH_ID STRING,
    CREATED_TS TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

-- Insert SEA loans
INSERT INTO SRC_LOANS VALUES
('LOAN001','CUST001','AUTO',68000.00,5.25,60,1285.45,51000.00,'ACTIVE','2021-06-01','2026-06-01','2024-10-01',720,'VEHICLE','BR_KL01',CURRENT_TIMESTAMP()),
('LOAN002','CUST002','MORTGAGE',950000.00,3.75,360,4390.07,912000.00,'ACTIVE','2019-06-01','2049-06-01','2024-11-01',780,'PROPERTY','BR_KL02',CURRENT_TIMESTAMP()),
('LOAN003','CUST005','PERSONAL',42000.00,8.99,36,1337.17,29400.00,'ACTIVE','2023-01-15','2026-01-15','2024-10-15',810,'NONE','BR_PG01',CURRENT_TIMESTAMP()),
('LOAN004','CUST008','MORTGAGE',1150000.00,3.25,360,5012.79,1110000.00,'ACTIVE','2020-01-01','2050-01-01','2024-11-01',750,'PROPERTY','BR_JB02',CURRENT_TIMESTAMP()),
('LOAN005','CUST010','AUTO',85000.00,4.99,72,1356.58,70500.00,'ACTIVE','2022-03-01','2028-03-01','2024-10-01',730,'VEHICLE','BR_SG02',CURRENT_TIMESTAMP()),
('LOAN006','CUST006','PERSONAL',22000.00,9.50,24,1004.00,12300.00,'ACTIVE','2023-06-01','2025-06-01','2024-10-01',700,'NONE','BR_PG02',CURRENT_TIMESTAMP()),
('LOAN007','CUST003','EDUCATION',120000.00,4.50,120,1245.39,101000.00,'ACTIVE','2021-09-01','2031-09-01','2024-09-01',690,'NONE','BR_KL03',CURRENT_TIMESTAMP()),
('LOAN008','CUST012','AUTO',75000.00,5.75,60,1439.51,53500.00,'ACTIVE','2022-08-01','2027-08-01','2024-10-01',760,'VEHICLE','BR_SG04',CURRENT_TIMESTAMP()),
('LOAN009','CUST013','PERSONAL',32000.00,10.99,48,820.39,24000.00,'DELINQUENT','2022-01-01','2026-01-01','2024-08-01',710,'NONE','BR_SL01',CURRENT_TIMESTAMP()),  -- Delinquent
('LOAN010','CUST007','AUTO',48000.00,6.25,48,1130.69,32000.00,'ACTIVE','2023-02-01','2027-02-01','2024-10-01',680,'VEHICLE','BR_JB01',CURRENT_TIMESTAMP()),
('LOAN011','CUST014','PERSONAL',13500.00,11.50,24,638.82,8600.00,'ACTIVE','2023-09-01','2025-09-01','2024-10-01',695,'NONE','BR_SL02',CURRENT_TIMESTAMP()),
('LOAN012','CUST011','EDUCATION',80000.00,5.00,120,848.56,74500.00,'ACTIVE','2023-09-01','2033-09-01','2024-10-01',300,'NONE','BR_SG03',CURRENT_TIMESTAMP());  -- Low credit score

-- =====================================================================
-- BRONZE LAYER COMPLETE
-- Next: Run 03_data_quality_validation.sql
-- =====================================================================

SELECT 'BRONZE LAYER DATA CREATED - SEA REGION!' AS STATUS;
SELECT 'Total Customers: ' || COUNT(*) AS INFO FROM SRC_CUSTOMERS;
SELECT 'Total Accounts: ' || COUNT(*) AS INFO FROM SRC_ACCOUNTS;
SELECT 'Total Transactions: ' || COUNT(*) AS INFO FROM SRC_TRANSACTIONS;
SELECT 'Total Loans: ' || COUNT(*) AS INFO FROM SRC_LOANS;